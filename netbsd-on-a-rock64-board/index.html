<!doctype html><html lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>NetBSD on a ROCK64 Board - Simone Vellei - Blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://simonevellei.com/netbsd-on-a-rock64-board/">
<meta property="og:site_name" content="Simone Vellei - Blog"><meta property="og:title" content="NetBSD on a ROCK64 Board"><meta property="og:description" content="This is the sequel to the previous post FreeBSD on a ROCK64 Board. Long story short, I had the chance to resurrect 4 single-board computers that were collecting dust in my office. I decided to install FreeBSD on one of them and it was a success. This time I will show you how and why I installed NetBSD on a second ROCK64 board.
Letâ€™s add connectivity to the FreeBSD board The process I described in the previous post was fun and I learned a lot. However, I used a USB-to-serial adapter to connect to the board, and even though it was fine to complete the installation, I wanted to have a more comfortable way to connect to the board."><meta property="og:locale" content="it"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-09T22:00:32+01:00"><meta property="article:modified_time" content="2024-11-09T22:00:32+01:00"><meta property="article:tag" content="Freebsd"><meta property="article:tag" content="Netbsd"><meta property="article:tag" content="Iot"><meta property="article:tag" content="Rock64"><meta property="article:tag" content="Gateway"><meta property="article:tag" content="Experiment"><meta property="og:image" content="https://simonevellei.com/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonevellei.com/logo.png"><meta name=twitter:title content="NetBSD on a ROCK64 Board"><meta name=twitter:description content="This is the sequel to the previous post FreeBSD on a ROCK64 Board. Long story short, I had the chance to resurrect 4 single-board computers that were collecting dust in my office. I decided to install FreeBSD on one of them and it was a success. This time I will show you how and why I installed NetBSD on a second ROCK64 board.
Letâ€™s add connectivity to the FreeBSD board The process I described in the previous post was fun and I learned a lot. However, I used a USB-to-serial adapter to connect to the board, and even though it was fine to complete the installation, I wanted to have a more comfortable way to connect to the board."><meta name=application-name content="Simone Vellei"><meta name=apple-mobile-web-app-title content="Simone Vellei"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://simonevellei.com/netbsd-on-a-rock64-board/><link rel=prev href=https://simonevellei.com/freebsd-on-a-rock64-board/><link rel=next href=https://simonevellei.com/3-anni-da-remoto-12-lezioni-imparate/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"NetBSD on a ROCK64 Board","inLanguage":"it","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/simonevellei.com\/netbsd-on-a-rock64-board\/"},"genre":"posts","keywords":"freebsd, netbsd, iot, rock64, gateway, experiment","wordcount":1060,"url":"https:\/\/simonevellei.com\/netbsd-on-a-rock64-board\/","datePublished":"2024-11-09T22:00:32+01:00","dateModified":"2024-11-09T22:00:32+01:00","license":"Â© 2025 Simone Vellei. All rights reserved.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Simone Vellei"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>ðŸ‘‹</span>Simone Vellei</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>ðŸ‘‹</span>Simone Vellei</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">NetBSD on a ROCK64 Board</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Simone Vellei</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-11-09>2024-11-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1060 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-008.jpg data-srcset="/images/rock64-008.jpg, /images/rock64-008.jpg 1.5x, /images/rock64-008.jpg 2x" data-sizes=auto alt=/images/rock64-008.jpg title=/images/rock64-008.jpg></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#lets-add-connectivity-to-the-freebsd-board>Let&rsquo;s add connectivity to the FreeBSD board</a></li><li><a href=#netbsd-to-the-rescue>NetBSD to the rescue</a><ul><li><a href=#configuring-the-wifi-interface>Configuring the wifi interface</a></li><li><a href=#configuring-the-ethernet-interface>Configuring the ethernet interface</a></li></ul></li><li><a href=#configuring-the-freebsd-board>Configuring the FreeBSD board</a></li></ul></nav></div></div><div class=content id=content><p>This is the sequel to the previous post <a href=https://simonevellei.com/blog/posts/freebsd-on-a-rock64-board/ target=_blank rel="noopener noreffer">FreeBSD on a ROCK64 Board</a>. Long story short, I had the chance to resurrect 4 single-board computers that were collecting dust in my office. I decided to install FreeBSD on one of them and it was a success. This time I will show you how and why I installed NetBSD on a second ROCK64 board.</p><h2 id=lets-add-connectivity-to-the-freebsd-board>Let&rsquo;s add connectivity to the FreeBSD board</h2><p>The process I described in the previous post was fun and I learned a lot. However, I used a USB-to-serial adapter to connect to the board, and even though it was fine to complete the installation, I wanted to have a more comfortable way to connect to the board.</p><blockquote><p>Did I tell you I have a lot of dust-collecting devices in my office?</p></blockquote><p>I remembered I had a USB wifi dongle that I bought a few years ago. This adapter is based on the Atheros AR9271 chipset, I knew it was supported by Linux at the time, but I wasn&rsquo;t sure about FreeBSD. After a quick search, I found the FreeBSD wiki page dedicated to <a href=https://wiki.freebsd.org/dev/ath%284%29 target=_blank rel="noopener noreffer">Atheros wireless driver support</a>. And you know what? The AR9271 chipset is not yet well supported along with the related USB HAL.</p><blockquote><p>Mmm, ok let&rsquo;s buy a cheap USB wifi dongle that is supported by FreeBSD.</p></blockquote><p>That was my first thought, and I started looking at the list of devices and then searching for the FreeBSD driver support. It was at that moment that a weird idea came to my mind: if this device is not supported by FreeBSD, why not try it with NetBSD?</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-006.jpg data-srcset="/images/rock64-006.jpg, /images/rock64-006.jpg 1.5x, /images/rock64-006.jpg 2x" data-sizes=auto alt=/images/rock64-006.jpg title=rock64></p><h2 id=netbsd-to-the-rescue>NetBSD to the rescue</h2><p>As I did with FreeBSD, I went to the Rock64 software release page to the <a href=https://wiki.pine64.org/wiki/ROCK64_Software_Releases#NetBSD target=_blank rel="noopener noreffer">NetBSD section</a>. It was very interesting dicover that the NetBSD image for my board was ready to <a href=https://nycdn.netbsd.org/pub/arm/ target=_blank rel="noopener noreffer">download</a> and use. A few minutes later I had the image on my computer and I was ready to flash it on the SD card.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo dd <span class=k>if</span><span class=o>=</span>NetBSD-10-aarch64--rock64.img <span class=nv>of</span><span class=o>=</span>/dev/sda <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>status</span><span class=o>=</span>progress
</span></span></code></pre></td></tr></table></div></div><p>It worked like a charm, unlike FreeBSD, NetBSD has the support for the eMMC boot, so it was very straightforward. Cool, next step was to connect the wifi dongle and see if it was recognized by the system.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ dmesg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>     2.755663<span class=o>]</span> : Atheros AR9271
</span></span><span class=line><span class=cl><span class=o>[</span>     2.755663<span class=o>]</span> athn0: rev <span class=m>1</span> <span class=o>(</span>1T1R<span class=o>)</span>, ROM rev 15, address 00:c0:ca:--:--:--
</span></span></code></pre></td></tr></table></div></div><p>The device was recognized and the driver was loaded. The <code>ifconfig</code> command showed the new interface <code>athn0</code>. The plan was clear, I had to configure the NetBSD system as gateway and connect it to the FreeBSD board via ethernet cable.</p><h3 id=configuring-the-wifi-interface>Configuring the wifi interface</h3><p>NetBSD has a dedicated web page to explain how to <a href=https://www.netbsd.org/docs/guide/en/chap-net-practice.html#chap-net-practice-lan-setup-wlan target=_blank rel="noopener noreffer">configure the wifi interface</a>, so I followed the instructions and configured the <code>athn0</code> interface.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/ifconfig.athn0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inet 192.168.1.2 netmask 255.255.255.0
</span></span></code></pre></td></tr></table></div></div><p>NetBSD uses WPA supplicant to manage the wifi connection, so I had to create a configuration file for the wifi network.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/wpa_supplicant.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ctrl_interface</span><span class=o>=</span>/var/run/wpa_supplicant
</span></span><span class=line><span class=cl><span class=nv>ctrl_interface_group</span><span class=o>=</span>wheel
</span></span><span class=line><span class=cl><span class=nv>update_config</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>network</span><span class=o>={</span>
</span></span><span class=line><span class=cl>	<span class=nv>ssid</span><span class=o>=</span><span class=s2>&#34;my-wifi-ssid&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nv>psk</span><span class=o>=</span>--------------------------------
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>After configuring the wifi interface I had to modify the <code>/etc/rc.conf</code> file to enable the <code>wpa_supplicant</code> service and set the <code>defaultroute</code> to the gateway IP address.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/rc.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=nv>wpa_supplicant</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl><span class=nv>wpa_supplicant_flags</span><span class=o>=</span><span class=s2>&#34;-B -D bsd -i athn0 -c /etc/wpa_supplicant.conf&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>defaultroute</span><span class=o>=</span><span class=s2>&#34;192.168.1.1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Lastly, I had to set the <code>nameserver</code> in the <code>/etc/resolv.conf</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/resolv.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nameserver 192.168.1.1
</span></span></code></pre></td></tr></table></div></div><p>The system was ready to connect to the wifi network and was able to reach the internet. The next step was to configure the ethernet interface to connect to the FreeBSD board.</p><h3 id=configuring-the-ethernet-interface>Configuring the ethernet interface</h3><p>Following the same steps as before, I configured the <code>awge0</code> interface with the IP address</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/ifconfig.awge0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>inet 10.0.0.1 netmask 255.255.255.0
</span></span></code></pre></td></tr></table></div></div><p>After configuring the ethernet interface I had to instruct the system to forward ip packets enabling the ip forwarding in the <code>/etc/sysctl.conf</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/sysctl.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>net.inet.ip.forwarding<span class=o>=</span><span class=m>1</span>
</span></span></code></pre></td></tr></table></div></div><p>The last step was to configure the <code>npf</code> firewall to enable NAT and forward the packets from the <code>awge0</code> interface to the <code>athn0</code> interface. I created the <code>/etc/npf.conf</code> file with the following rules.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$ext_if</span> <span class=o>=</span> <span class=o>{</span> inet4<span class=o>(</span>athn0<span class=o>)</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nv>$int_if</span> <span class=o>=</span> <span class=o>{</span> inet4<span class=o>(</span>awge0<span class=o>)</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$services_tcp</span> <span class=o>=</span> <span class=o>{</span> <span class=m>2222</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=nv>$localnet</span> <span class=o>=</span> <span class=o>{</span> 10.0.0.0/24 <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>alg <span class=s2>&#34;icmp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>map <span class=nv>$ext_if</span> dynamic 10.0.0.0/24 -&gt; ifaddrs<span class=o>(</span><span class=nv>$ext_if</span><span class=o>)</span>
</span></span><span class=line><span class=cl>map <span class=nv>$ext_if</span> dynamic proto tcp 10.0.0.2 port <span class=m>22</span> &lt;- ifaddrs<span class=o>(</span><span class=nv>$ext_if</span><span class=o>)</span> port <span class=m>2222</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>procedure <span class=s2>&#34;log&#34;</span> <span class=o>{</span>        
</span></span><span class=line><span class=cl>        log: npflog0
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>group <span class=s2>&#34;external&#34;</span> on <span class=nv>$ext_if</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        pass stateful out final all
</span></span><span class=line><span class=cl>        pass stateful in final family inet4 proto tcp to <span class=nv>$ext_if</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                port ssh apply <span class=s2>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>        pass stateful in final proto tcp to <span class=nv>$ext_if</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                port <span class=nv>$services_tcp</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>group <span class=s2>&#34;internal&#34;</span> on <span class=nv>$int_if</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        block in all
</span></span><span class=line><span class=cl>        pass in final from <span class=nv>$localnet</span>
</span></span><span class=line><span class=cl>        pass out final all
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>group default <span class=o>{</span>
</span></span><span class=line><span class=cl>        pass final on lo0 all
</span></span><span class=line><span class=cl>        block all
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The firewall rules allow connections to the FreeBSD board via ssh on port <code>2222</code>.
The <code>man npf.conf</code> page was very helpful to understand the syntax and the rules and it contains a good example to start with. After creating the <code>npf.conf</code> file I had to enable the <code>npf</code> service in the <code>/etc/rc.conf</code> file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/rc.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=nv>npf</span><span class=o>=</span>YES
</span></span></code></pre></td></tr></table></div></div><p>That was it, the NetBSD system was ready to act as a gateway and connect to the FreeBSD board.</p><h2 id=configuring-the-freebsd-board>Configuring the FreeBSD board</h2><p>The last step was to configure the FreeBSD board to connect to the NetBSD gateway. I configured the <code>dwc0</code> interface with a static IP address and set the <code>defaultrouter</code> to the NetBSD gateway IP address.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat /etc/rc.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=nv>ifconfig_dwc0</span><span class=o>=</span><span class=s2>&#34;inet 10.0.0.2 netmask 255.255.255.0&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>defaultrouter</span><span class=o>=</span><span class=s2>&#34;10.0.0.1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-007.jpg data-srcset="/images/rock64-007.jpg, /images/rock64-007.jpg 1.5x, /images/rock64-007.jpg 2x" data-sizes=auto alt=/images/rock64-007.jpg title=rock64></p><p>And&mldr; it worked! I was able to connect to the FreeBSD board via ssh on port <code>2222</code> using the NetBSD gateway!</p><p>I had a lot of fun configuring the NetBSD system as a gateway and connecting it to the FreeBSD board. I learned a lot about the NetBSD system and I was impressed by the simplicity and the clarity of the documentation. I will definitely use NetBSD in the future for other projects!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2024-11-09</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/netbsd-on-a-rock64-board/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://simonevellei.com/netbsd-on-a-rock64-board/ data-hashtag=freebsd><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://simonevellei.com/netbsd-on-a-rock64-board/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://simonevellei.com/netbsd-on-a-rock64-board/ data-title="NetBSD on a ROCK64 Board" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/freebsd/>Freebsd</a>,&nbsp;<a href=/tags/netbsd/>Netbsd</a>,&nbsp;<a href=/tags/iot/>Iot</a>,&nbsp;<a href=/tags/rock64/>Rock64</a>,&nbsp;<a href=/tags/gateway/>Gateway</a>,&nbsp;<a href=/tags/experiment/>Experiment</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/freebsd-on-a-rock64-board/ class=prev rel=prev title="FreeBSD on a ROCK64 Board"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>FreeBSD on a ROCK64 Board</a>
<a href=/3-anni-da-remoto-12-lezioni-imparate/ class=next rel=next title="3 anni da remoto, 12 lezioni imparate">3 anni da remoto, 12 lezioni imparate<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Simone Vellei</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>