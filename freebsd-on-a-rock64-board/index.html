<!doctype html><html lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>FreeBSD on a ROCK64 Board - Simone Vellei - Blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://simonevellei.com/freebsd-on-a-rock64-board/">
<meta property="og:site_name" content="Simone Vellei - Blog"><meta property="og:title" content="FreeBSD on a ROCK64 Board"><meta property="og:description" content="Info Questo post è stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.
🇬🇧 Leggi l’articolo originale in inglese
Questa è la storia di una scheda embedded e di un sistema BSD. Il titolo avrebbe potuto essere “Come resuscitare una scheda dimenticata e innamorarsi di nuovo dei sistemi operativi BSD”. Tutto è iniziato 6 anni fa quando ho comprato 4 schede Pine Rock64, con un progetto ben pianificato in mente. Ogni scheda era equipaggiata con un processore Rockchip RK3328 quad-core ARM Cortex A53 a 64 bit, 4 GB di RAM, 32 GB di memoria eMMC e una porta Ethernet Gigabit."><meta property="og:locale" content="it"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-01T16:37:37+01:00"><meta property="article:modified_time" content="2024-11-01T16:37:37+01:00"><meta property="article:tag" content="Freebsd"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Iot"><meta property="article:tag" content="Embedded"><meta property="article:tag" content="Experiment"><meta property="og:image" content="https://simonevellei.com/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonevellei.com/logo.png"><meta name=twitter:title content="FreeBSD on a ROCK64 Board"><meta name=twitter:description content="Info Questo post è stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.
🇬🇧 Leggi l’articolo originale in inglese
Questa è la storia di una scheda embedded e di un sistema BSD. Il titolo avrebbe potuto essere “Come resuscitare una scheda dimenticata e innamorarsi di nuovo dei sistemi operativi BSD”. Tutto è iniziato 6 anni fa quando ho comprato 4 schede Pine Rock64, con un progetto ben pianificato in mente. Ogni scheda era equipaggiata con un processore Rockchip RK3328 quad-core ARM Cortex A53 a 64 bit, 4 GB di RAM, 32 GB di memoria eMMC e una porta Ethernet Gigabit."><meta name=application-name content="Simone Vellei"><meta name=apple-mobile-web-app-title content="Simone Vellei"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://simonevellei.com/freebsd-on-a-rock64-board/><link rel=prev href=https://simonevellei.com/anthropic-claude-integration-with-go-and-lingoose/><link rel=next href=https://simonevellei.com/netbsd-on-a-rock64-board/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"FreeBSD on a ROCK64 Board","inLanguage":"it","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/simonevellei.com\/freebsd-on-a-rock64-board\/"},"genre":"posts","keywords":"freebsd, linux, iot, embedded, experiment","wordcount":1543,"url":"https:\/\/simonevellei.com\/freebsd-on-a-rock64-board\/","datePublished":"2024-11-01T16:37:37+01:00","dateModified":"2024-11-01T16:37:37+01:00","license":"© 2025 Simone Vellei. All rights reserved.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Simone Vellei"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>👋</span>Simone Vellei</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Articoli </a><a class=menu-item href=/tags/>Tag </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Cerca il titolo o il contenuto dell'articolo ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Cerca><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Chiaro><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Cambiare il tema"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Scegliere la lingua"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/freebsd-on-a-rock64-board/ selected>Italiano</option><option value=/en/freebsd-on-a-rock64-board/>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>👋</span>Simone Vellei</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Cerca il titolo o il contenuto dell'articolo ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Cerca><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Chiaro><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Annulla</a></div><a class=menu-item href=/posts/ title>Articoli</a><a class=menu-item href=/tags/ title>Tag</a><a href=javascript:void(0); class="menu-item theme-switch" title="Cambiare il tema">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Scegliere la lingua"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/freebsd-on-a-rock64-board/ selected>Italiano</option><option value=/en/freebsd-on-a-rock64-board/>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contenuti</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">FreeBSD on a ROCK64 Board</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Simone Vellei</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-11-01>2024-11-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1543 parole&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;8 minuti&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-004.png data-srcset="/images/rock64-004.png, /images/rock64-004.png 1.5x, /images/rock64-004.png 2x" data-sizes=auto alt=/images/rock64-004.png title=/images/rock64-004.png></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contenuti</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#la-resurrezione>La resurrezione</a></li><li><a href=#documentazione>Documentazione</a></li><li><a href=#la-via-bsd>La via BSD</a></li><li><a href=#mai-arrendersi>Mai arrendersi</a></li><li><a href=#tentativo-1-compilare-il-kernel-freebsd-su-un-sistema-linux>Tentativo #1: Compilare il kernel FreeBSD su un sistema Linux</a></li><li><a href=#tentativo-2-compilare-il-kernel-freebsd-su-un-sistema-freebsd>Tentativo #2: Compilare il kernel FreeBSD su un sistema FreeBSD</a><ul><li><a href=#avviare-la-macchina-virtuale-freebsd>Avviare la macchina virtuale FreeBSD</a></li><li><a href=#compilare-il-kernel-freebsd>Compilare il kernel FreeBSD</a></li><li><a href=#copiare-il-kernel-nellimmagine-rock64>Copiare il kernel nell’immagine ROCK64</a></li><li><a href=#flashare-la-emmc>Flashare la eMMC</a></li></ul></li><li><a href=#il-momento-della-verità>Il momento della verità</a></li><li><a href=#conclusione-e-domande>Conclusione e domande</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Questo post è stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.</p><p><a href=/en/freebsd-on-a-rock64-board/ rel>🇬🇧 Leggi l&rsquo;articolo originale in inglese</a></p></div></div></div><p>Questa è la storia di una scheda embedded e di un sistema BSD. Il titolo avrebbe potuto essere &ldquo;Come resuscitare una scheda dimenticata e innamorarsi di nuovo dei sistemi operativi BSD&rdquo;.
Tutto è iniziato 6 anni fa quando ho comprato 4 schede Pine Rock64, con un progetto ben pianificato in mente. Ogni scheda era equipaggiata con un processore Rockchip RK3328 quad-core ARM Cortex A53 a 64 bit, 4 GB di RAM, 32 GB di memoria eMMC e una porta Ethernet Gigabit.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-001.png data-srcset="/images/rock64-001.png, /images/rock64-001.png 1.5x, /images/rock64-001.png 2x" data-sizes=auto alt=/images/rock64-001.png title=image></p><p>Il progetto era costruire un cluster di 4 schede per sperimentare con Kubernetes e Docker. Ero molto entusiasta del progetto, ma purtroppo non ho mai avuto il tempo di portarlo avanti. L’unica cosa che ho fatto è stata costruire un rack per tenere insieme le 4 schede, incluso un piccolo switch a 5 porte e un alimentatore. Il rack è stato messo in un angolo del mio ufficio e dimenticato dopo alcuni test preliminari.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-003.png data-srcset="/images/rock64-003.png, /images/rock64-003.png 1.5x, /images/rock64-003.png 2x" data-sizes=auto alt=/images/rock64-003.png title=image></p><h2 id=la-resurrezione>La resurrezione</h2><p>Qualche giorno fa stavo pulendo il mio ufficio e ho trovato il rack con le 4 schede. Ho deciso di fare un tentativo e vedere se potevo farle funzionare. Ho collegato l’alimentatore e lo switch, e ho acceso le schede. Le schede si avviavano, ho provato a connettermi tramite la console seriale, ma non ricordavo la password di root. Ho preso questo come un <strong>segno</strong>, ricominciamo da zero. Avevo ancora l’adattatore USB per eMMC originale per flashare un’immagine OS e più o meno 20 anni di esperienza IoT sulle spalle. Pronti, via!</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-002.png data-srcset="/images/rock64-002.png, /images/rock64-002.png 1.5x, /images/rock64-002.png 2x" data-sizes=auto alt=/images/rock64-002.png title=image></p><h2 id=documentazione>Documentazione</h2><p>Prima cosa, controlliamo la documentazione. Sono andato sul sito Pine64 e ho trovato la pagina <a href=https://pine64.org/devices/rock64/ target=_blank rel="noopener noreffer">Rock64 device</a> e la <a href=https://wiki.pine64.org/wiki/Rock64 target=_blank rel="noopener noreffer">wiki Rock64</a>. Il tempo vola, e ricordo un sito diverso, ma sono stato felice di vedere la pagina <a href=https://pine64.org/documentation/ROCK64/Software/Releases/ target=_blank rel="noopener noreffer">Release</a> con le ultime immagini OS supportate. Ci sono molte distribuzioni Linux, Debian, l’Armbian derivata, e una miriade di versioni Android. Ehi, sto diventando così vecchio? Poi il cuore mi si è calmato quando ho visto il supporto a FreeBSD, NetBSD e OpenBSD.</p><blockquote><p>&ldquo;Sono ancora lì&rdquo;, ho pensato.</p></blockquote><p>Tuttavia, solo per capire se le schede funzionavano ancora, ho deciso di flashare l’ultima immagine Armbian. Ho scaricato l’immagine, l’ho flashata sulla eMMC e ho acceso una scheda. La scheda si è avviata e sono riuscito a connettermi tramite console seriale.</p><blockquote><p>Fantastico! Ma aspetta&mldr; guarda l’output di <code>ps aux</code>!</p></blockquote><p>Scusate ragazzi, sono della vecchia scuola, non sopporto <code>systemd</code>. Sì, devo confessare di essere stato pigro negli ultimi anni e di aver usato Ubuntu per il mio PC desktop, ma dai, è una scheda embedded, avrei voluto spremere il massimo delle prestazioni e avere il pieno controllo del sistema. Il mio cuore è diventato improvvisamente meno felice.</p><h2 id=la-via-bsd>La via BSD</h2><p>La faccio breve, ma meriterebbe un altro post. La mia prima esperienza con un OS BSD fu con OpenBSD all’università nel 2003 per superare l’esame di Sicurezza e Crittografia. Dovevo fare una ricerca e scrivere un paper sulle funzionalità di sicurezza e crittografia di OpenBSD. Ho iniziato installando OpenBSD sul mio PC desktop per metterci le mani, e me ne sono innamorato. Ma, ancora una volta, questa è un’altra storia.</p><p>Ho deciso di installare FreeBSD sulle schede Rock64. Sono andato sul sito FreeBSD e ho scoperto che c’erano immagini precompilate per ROCK64 arm.</p><blockquote><p>&ldquo;Wow, incredibile!&rdquo;, ho pensato.</p></blockquote><p>Ho scaricato l’immagine, l’ho flashata sulla eMMC e ho acceso una scheda. Sembrava funzionare tutto bene, ma a un certo punto la scheda si è bloccata. Ho provato a capire cosa stava succedendo, ma non riuscivo a trovare la causa. Da lì ho iniziato a indagare, e ho scoperto che il problema era legato al supporto di boot su eMMC.</p><blockquote><p>Ah-ah, sarebbe stato troppo facile!</p></blockquote><h2 id=mai-arrendersi>Mai arrendersi</h2><p>Il problema era che il kernel FreeBSD incluso nell’immagine ROCK64 non supportava il boot da eMMC. Tuttavia, dopo alcune ricerche, ho trovato un <a href=https://www.idatum.net/ads-b-on-a-rock64-with-freebsd-stable14.html target=_blank rel="noopener noreffer">post sul blog</a> che spiegava come compilare un kernel personalizzato e risolvere il problema per quella scheda.</p><blockquote><p>Bello! Ma&mldr;vi ho detto che sono diventato un pigro utente Linux Ubuntu?</p></blockquote><p>L’autore del post spiegava come compilare il kernel su un sistema FreeBSD, e la mia domanda successiva è stata: &ldquo;È possibile compilare un kernel FreeBSD su un sistema Linux?&rdquo;. Torno su Google e stavolta atterro su una <a href=https://wiki.freebsd.org/BuildingOnNonFreeBSD target=_blank rel="noopener noreffer">pagina wiki di FreeBSD</a> che spiega come compilare un kernel FreeBSD su un sistema Linux. Sono abituato a costruire sistemi embedded Linux da zero a partire dal cross-compiling del kernel, quindi mi sentivo a casa.</p><h2 id=tentativo-1-compilare-il-kernel-freebsd-su-un-sistema-linux>Tentativo #1: Compilare il kernel FreeBSD su un sistema Linux</h2><p>Ho seguito le istruzioni e scaricato il codice sorgente di FreeBSD.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git clone https://git.FreeBSD.org/src.git
</span></span></code></pre></td></tr></table></div></div><p>Ho poi installato i pacchetti richiesti sul mio sistema Ubuntu</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo apt install clang libarchive-dev libbz2-dev
</span></span></code></pre></td></tr></table></div></div><p>Poiché Linux non include di default una versione di bmake, la compilazione deve essere fatta usando lo script <code>tools/build/make.py</code> che farà il bootstrap di bmake prima di tentare la build.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>export</span> <span class=nv>MAKEOBJDIRPREFIX</span><span class=o>=</span>~/freebsd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ tools/build/make.py buildkernel <span class=nv>TARGET</span><span class=o>=</span>arm64 <span class=nv>TARGET_ARCH</span><span class=o>=</span>aarch64 <span class=nv>KERNCONF</span><span class=o>=</span>ROCK64
</span></span></code></pre></td></tr></table></div></div><p>Tuttavia, la compilazione è fallita con un errore legato al comando <code>config</code> mancante. Non sono ancora sicuro di non aver dimenticato qualcosa, ma ho deciso di provare un altro approccio.</p><h2 id=tentativo-2-compilare-il-kernel-freebsd-su-un-sistema-freebsd>Tentativo #2: Compilare il kernel FreeBSD su un sistema FreeBSD</h2><p>Mi sono reso conto che avevo bisogno di un sistema FreeBSD per compilare il kernel.</p><blockquote><p><em>Qual è il modo più veloce per avere un sistema FreeBSD funzionante? Una macchina virtuale nel cloud, oppure&mldr;una macchina virtuale sul mio PC! Dove sei, QEMU, vecchio amico?</em></p></blockquote><p>La sorpresa successiva è stata trovare immagini qcow2 precompilate di FreeBSD nel <a href=https://download.freebsd.org/releases/VM-IMAGES/14.1-RELEASE/amd64/Latest/ target=_blank rel="noopener noreffer">repository ufficiale</a>. Sembrava che fossi fortunato, ho scaricato l’immagine e avviato una macchina virtuale con QEMU. Tuttavia, per avere abbastanza spazio per compilare il kernel, ho dovuto ridimensionare l’immagine disco. Da questo punto in poi, la storia diventerà più nerd.</p><h3 id=avviare-la-macchina-virtuale-freebsd>Avviare la macchina virtuale FreeBSD</h3><p>Ridimensioniamo l’immagine disco e avviamo la macchina virtuale.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ qemu-img resize ~/FreeBSD-14.1-RELEASE-amd64-zfs.qcow2 +10G
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ qemu-system-x86_64 -hda ~/FreeBSD-14.1-RELEASE-amd64-zfs.qcow2 -m <span class=m>2048</span> -enable-kvm  -netdev user,id<span class=o>=</span>mynet0,hostfwd<span class=o>=</span>tcp:127.0.0.1:7722-:22 -device e1000,netdev<span class=o>=</span>mynet0
</span></span></code></pre></td></tr></table></div></div><p>Mi sono connesso alla VM e ho esteso l’ultima partizione del disco virtuale per usare lo spazio aggiunto.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpart show ada0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ gpart resize -i <span class=m>4</span> -a 4k ada0
</span></span></code></pre></td></tr></table></div></div><p>Una volta ridimensionata la partizione, ho istruito ZFS a espandere il pool per usare lo spazio extra.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ zpool list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ zpool online -e zroot ada0p4
</span></span></code></pre></td></tr></table></div></div><h3 id=compilare-il-kernel-freebsd>Compilare il kernel FreeBSD</h3><p>Dopo aver clonato il codice sorgente di FreeBSD, ho installato i pacchetti richiesti.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pkg update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ pkg install git gcc gmake python pkgconf pixman bison glib 
</span></span></code></pre></td></tr></table></div></div><p>e finalmente ho compilato il kernel.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>make buildkernel <span class=nv>TARGET</span><span class=o>=</span>arm64 <span class=nv>KERNCONF</span><span class=o>=</span>ROCK64
</span></span></code></pre></td></tr></table></div></div><p>Fantastico! Ha funzionato! Ero molto vicino all’obiettivo finale. Dovevo solo copiare il kernel nell’immagine ROCK64 e poi flasharlo sulla eMMC.</p><h3 id=copiare-il-kernel-nellimmagine-rock64>Copiare il kernel nell’immagine ROCK64</h3><p>Ho scaricato l’immagine ROCK64 dal <a href=https://download.freebsd.org/ftp/snapshots/ISO-IMAGES/14.1/ target=_blank rel="noopener noreffer">sito FreeBSD</a> e l’ho decompressa.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ wget https://download.freebsd.org/ftp/snapshots/ISO-IMAGES/14.1/FreeBSD-14.1-STABLE-arm64-aarch64-ROCK64-20241017-d36ba3989ca9-269125.img.xz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ unxz FreeBSD-14.1-STABLE-arm64-aarch64-ROCK64-20241017-d36ba3989ca9-269125.img.xz
</span></span></code></pre></td></tr></table></div></div><p>Poi ho montato la partizione di boot dell’immagine.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mdconfig -a -t vnode -f /root/FreeBSD-14.1-STABLE-arm64-aarch64-ROCK64-20241017-d36ba3989ca9-269125.img
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mdconfig -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ gpart show md0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mount -t ufs /dev/md0p2 /mnt
</span></span></code></pre></td></tr></table></div></div><p>Ok, tornando alla directory di compilazione del kernel, ho copiato il kernel nella partizione di boot dell’immagine ROCK64 e poi l’ho smontata.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ make installkernel <span class=nv>TARGET</span><span class=o>=</span>arm64 <span class=nv>KERNCONF</span><span class=o>=</span>ROCK64 <span class=nv>DESTDIR</span><span class=o>=</span>/mnt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ umount /mnt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mdconfig -d -u md0
</span></span></code></pre></td></tr></table></div></div><h3 id=flashare-la-emmc>Flashare la eMMC</h3><p>Ho collegato l’adattatore USB per eMMC al mio PC e ho flashato l’immagine ROCK64 sulla eMMC.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ scp -P <span class=m>7722</span> root@localhost:/root/FreeBSD-14.1-STABLE-arm64-aarch64-ROCK64-20241017-d36ba3989ca9-269125.img ~/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo dd <span class=k>if</span><span class=o>=</span>FreeBSD-13.4-STABLE-arm64-aarch64-ROCK64-20241024-9db8fd4c2adc-258557.img <span class=nv>of</span><span class=o>=</span>/dev/sda <span class=nv>bs</span><span class=o>=</span>1M <span class=nv>status</span><span class=o>=</span>progress
</span></span></code></pre></td></tr></table></div></div><h2 id=il-momento-della-verità>Il momento della verità</h2><p>Ho acceso la scheda, e si è avviata correttamente. Mi sono connesso tramite console seriale e ho potuto vedere i messaggi di avvio di FreeBSD. Ero molto felice, e mi sentivo come un bambino con un nuovo giocattolo. Ho iniziato a esplorare il sistema e ho scoperto che la scheda funzionava bene. Potevo connettermi via SSH e installare pacchetti con il package manager.</p><blockquote><p>&ldquo;Ce l’ho fatta!&rdquo;, ho pensato.</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/rock64-005.png data-srcset="/images/rock64-005.png, /images/rock64-005.png 1.5x, /images/rock64-005.png 2x" data-sizes=auto alt=/images/rock64-005.png title=image></p><h2 id=conclusione-e-domande>Conclusione e domande</h2><p>Sono molto felice di aver resuscitato le schede Rock64 e di aver installato FreeBSD su di esse. Tuttavia, ho alcune domande che vorrei condividere con voi.</p><ol><li><p>Bella storia, ma ne è valsa la pena? Voglio dire, è valsa la pena passare così tanto tempo per installare FreeBSD su una scheda Rock64 quando avrei potuto usare QEMU per eseguire una macchina virtuale FreeBSD sul mio PC? <strong>Sì, ne è valsa la pena. Ho imparato molte cose e mi sono divertito. La sensazione di avere una scheda fisica che esegue FreeBSD non ha prezzo.</strong></p></li><li><p>Bel tentativo, ma potrebbero esserci altri modi, più semplici, per ottenere lo stesso risultato? <strong>Sono abbastanza sicuro che ci siano modi diversi per ottenere lo stesso risultato così come sono sicuro di essermi perso qualcosa nel processo. Ma, di nuovo, mi sono divertito.</strong></p></li><li><p>Qual è stato il primo comando shell che ho digitato nel sistema FreeBSD? <strong>Vi ho detto che non sopporto <code>systemd</code>? Volevo essere sicuro di avere il sistema di init che mi piace, quindi ho digitato <code>ls /etc/rc.d/</code>.</strong></p></li><li><p>Perché ho scelto FreeBSD invece di OpenBSD o NetBSD? <strong>Oh, beh&mldr;questa storia potrebbe avere un seguito 😉.</strong></p></li></ol></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Aggiornato il 2024-11-01</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/freebsd-on-a-rock64-board/index.md target=_blank>Leggi Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Condividi su Facebook" data-sharer=facebook data-url=https://simonevellei.com/freebsd-on-a-rock64-board/ data-hashtag=freebsd><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Condividi su Linkedin" data-sharer=linkedin data-url=https://simonevellei.com/freebsd-on-a-rock64-board/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Condividi su WhatsApp" data-sharer=whatsapp data-url=https://simonevellei.com/freebsd-on-a-rock64-board/ data-title="FreeBSD on a ROCK64 Board" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/freebsd/>Freebsd</a>,&nbsp;<a href=/tags/linux/>Linux</a>,&nbsp;<a href=/tags/iot/>Iot</a>,&nbsp;<a href=/tags/embedded/>Embedded</a>,&nbsp;<a href=/tags/experiment/>Experiment</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Indietro</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/anthropic-claude-integration-with-go-and-lingoose/ class=prev rel=prev title="Anthropic's Claude Integration with Go and Lingoose"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Anthropic's Claude Integration with Go and Lingoose</a>
<a href=/netbsd-on-a-rock64-board/ class=next rel=next title="NetBSD on a ROCK64 Board">NetBSD on a ROCK64 Board<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Realizzato da <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Simone Vellei</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Torna all'inizio"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="Vedi commenti"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.it.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copia negli appunti",maxShownLines:50},comment:{},cookieconsent:{content:{allow:"Allow cookies",close:"&#x274c;",deny:"Decline",dismiss:"Got it!",href:"https://www.cookiesandyou.com",link:"Learn more",message:"This website uses cookies to improve your experience.",policy:"Cookie Policy",target:"_blank"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless",type:"opt-out"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"it",maxResultLength:10,noResultsFound:"Nessun risultato trovato",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>