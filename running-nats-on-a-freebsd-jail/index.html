<!doctype html><html lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Running NATS on a FreeBSD Jail - Simone Vellei - Blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://simonevellei.com/running-nats-on-a-freebsd-jail/">
<meta property="og:site_name" content="Simone Vellei - Blog"><meta property="og:title" content="Running NATS on a FreeBSD Jail"><meta property="og:description" content="Info Questo post Ã¨ stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.
ðŸ‡¬ðŸ‡§ Leggi il post originale in inglese
Negli ultimi mesi ho giocato con FreeBSD e le mie schede embedded Rock64 [1] [2]. Mi sono davvero divertito con lâ€™esperienza e ho voluto passare al livello successivo sperimentando con le FreeBSD jails. Sono rimasto sorpreso da quanto fosse facile (e logico) creare e gestire un ambiente isolato. Ho anche notato che i comandi di basso livello sono stati incapsulati in interfacce piÃ¹ user-friendly (come bastille), rendendo lâ€™esperienza complessiva molto piÃ¹ piacevole. Per avere un vero esempio di un microservizio in esecuzione in una jail, ho deciso di provare con NATS."><meta property="og:locale" content="it"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-01T15:26:03+01:00"><meta property="article:modified_time" content="2025-01-01T15:26:03+01:00"><meta property="article:tag" content="Nats"><meta property="article:tag" content="Freebsd"><meta property="article:tag" content="Jail"><meta property="article:tag" content="Bastille"><meta property="article:tag" content="Go"><meta property="og:image" content="https://simonevellei.com/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://simonevellei.com/logo.png"><meta name=twitter:title content="Running NATS on a FreeBSD Jail"><meta name=twitter:description content="Info Questo post Ã¨ stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.
ðŸ‡¬ðŸ‡§ Leggi il post originale in inglese
Negli ultimi mesi ho giocato con FreeBSD e le mie schede embedded Rock64 [1] [2]. Mi sono davvero divertito con lâ€™esperienza e ho voluto passare al livello successivo sperimentando con le FreeBSD jails. Sono rimasto sorpreso da quanto fosse facile (e logico) creare e gestire un ambiente isolato. Ho anche notato che i comandi di basso livello sono stati incapsulati in interfacce piÃ¹ user-friendly (come bastille), rendendo lâ€™esperienza complessiva molto piÃ¹ piacevole. Per avere un vero esempio di un microservizio in esecuzione in una jail, ho deciso di provare con NATS."><meta name=application-name content="Simone Vellei"><meta name=apple-mobile-web-app-title content="Simone Vellei"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://simonevellei.com/running-nats-on-a-freebsd-jail/><link rel=prev href=https://simonevellei.com/3-anni-da-remoto-12-lezioni-imparate/><link rel=next href=https://simonevellei.com/referendum-2025/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Running NATS on a FreeBSD Jail","inLanguage":"it","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/simonevellei.com\/running-nats-on-a-freebsd-jail\/"},"genre":"posts","keywords":"nats, freebsd, jail, bastille, go","wordcount":1494,"url":"https:\/\/simonevellei.com\/running-nats-on-a-freebsd-jail\/","datePublished":"2025-01-01T15:26:03+01:00","dateModified":"2025-01-01T15:26:03+01:00","license":"Â© 2025 Simone Vellei. All rights reserved.","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Simone Vellei"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>ðŸ‘‹</span>Simone Vellei</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Articoli </a><a class=menu-item href=/tags/>Tag </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Cerca il titolo o il contenuto dell'articolo ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Cerca><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Chiaro><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Cambiare il tema"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Scegliere la lingua"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/running-nats-on-a-freebsd-jail/ selected>Italiano</option><option value=/en/running-nats-on-a-freebsd-jail/>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Simone Vellei - Blog"><span class=header-title-pre>ðŸ‘‹</span>Simone Vellei</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Cerca il titolo o il contenuto dell'articolo ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Cerca><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Chiaro><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Annulla</a></div><a class=menu-item href=/posts/ title>Articoli</a><a class=menu-item href=/tags/ title>Tag</a><a href=javascript:void(0); class="menu-item theme-switch" title="Cambiare il tema">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Scegliere la lingua"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/running-nats-on-a-freebsd-jail/ selected>Italiano</option><option value=/en/running-nats-on-a-freebsd-jail/>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contenuti</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Running NATS on a FreeBSD Jail</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Simone Vellei</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-01-01>2025-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1494 parole&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;8 minuti&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/nats001.png data-srcset="/images/nats001.png, /images/nats001.png 1.5x, /images/nats001.png 2x" data-sizes=auto alt=/images/nats001.png title=/images/nats001.png></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contenuti</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#cosÃ¨-nats>Cosâ€™Ã¨ NATS?</a></li><li><a href=#cosÃ¨-una-freebsd-jail>Cosâ€™Ã¨ una FreeBSD jail?</a></li><li><a href=#cosÃ¨-bastille>Cosâ€™Ã¨ Bastille?</a><ul><li><a href=#implementare-un-template-bastille-per-nats>Implementare un template Bastille per NATS</a></li></ul></li><li><a href=#creare-una-jail-nats>Creare una jail NATS</a></li><li><a href=#testare-la-jail-nats>Testare la jail NATS</a></li><li><a href=#conclusione>Conclusione</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Questo post Ã¨ stato originariamente scritto in inglese e tradotto in italiano tramite AI. Se noti errori di traduzione o passaggi poco chiari, segnalamelo pure.</p><p>ðŸ‡¬ðŸ‡§ <a href=/en/running-nats-on-a-freebsd-jail/ rel>Leggi il post originale in inglese</a></p></div></div></div><p>Negli ultimi mesi ho giocato con FreeBSD e le mie schede embedded Rock64 [<a href=https://simonevellei.com/blog/posts/freebsd-on-a-rock64-board/ target=_blank rel="noopener noreffer">1</a>] [<a href=https://simonevellei.com/blog/posts/netbsd-on-a-rock64-board/ target=_blank rel="noopener noreffer">2</a>]. Mi sono davvero divertito con lâ€™esperienza e ho voluto passare al livello successivo sperimentando con le <em>FreeBSD jails</em>. Sono rimasto sorpreso da quanto fosse facile (e logico) creare e gestire un ambiente isolato. Ho anche notato che i comandi di basso livello sono stati incapsulati in interfacce piÃ¹ user-friendly (come <code>bastille</code>), rendendo lâ€™esperienza complessiva molto piÃ¹ piacevole. Per avere un vero esempio di un microservizio in esecuzione in una jail, ho deciso di provare con <a href=https://nats.io target=_blank rel="noopener noreffer">NATS</a>.</p><h2 id=cosÃ¨-nats>Cosâ€™Ã¨ NATS?</h2><p><a href=https://nats.io target=_blank rel="noopener noreffer">NATS</a> Ã¨ un sistema di messaggistica open-source progettato per applicazioni <em>cloud-native</em>, messaggistica IoT e architetture a microservizi. Fornisce un meccanismo di comunicazione leggero, ad alte prestazioni e sicuro, che supporta sia i modelli <em>publish-subscribe</em> che <em>request-reply</em>. NATS Ã¨ noto per la sua semplicitÃ , facilitÃ  dâ€™uso e capacitÃ  di scalare orizzontalmente, rendendolo una scelta ideale per sistemi distribuiti.</p><p>Una delle caratteristiche principali di NATS Ã¨ la capacitÃ  di gestire messaggi ad alto throughput e bassa latenza. Questo Ã¨ possibile grazie a una combinazione di un protocollo efficiente, strutture dati in memoria e comunicazione di rete ottimizzata. NATS supporta anche il <em>clustering</em>, che consente a piÃ¹ server NATS di lavorare insieme per fornire tolleranza ai guasti e bilanciamento del carico.</p><p>Oltre alle sue funzionalitÃ  di messaggistica di base, NATS dispone di un ricco ecosistema di client e librerie per vari linguaggi di programmazione, rendendo facile lâ€™integrazione con diverse applicazioni e servizi. Offre anche funzionalitÃ  avanzate come <em>streaming</em>, persistenza e sicurezza, che possono essere sfruttate per costruire soluzioni di messaggistica robuste e affidabili.</p><h2 id=cosÃ¨-una-freebsd-jail>Cosâ€™Ã¨ una FreeBSD jail?</h2><p>Le <em>FreeBSD jails</em> sono una caratteristica potente e flessibile del sistema operativo FreeBSD che consente di creare ambienti isolati e sicuri allâ€™interno di una singola istanza FreeBSD. Introdotte in FreeBSD 4.0, le jails offrono unâ€™alternativa leggera alla virtualizzazione completa, permettendo di eseguire piÃ¹ applicazioni o servizi in spazi separati e confinati senza il sovraccarico di una macchina virtuale completa.</p><p>Una jail FreeBSD funziona come un ambiente <em>chroot</em> con funzionalitÃ  aggiuntive di sicurezza e gestione delle risorse. Ogni jail ha il proprio filesystem, le proprie interfacce di rete e lo spazio dei processi, garantendo che i processi in esecuzione allâ€™interno di una jail non possano interferire con quelli di altre jails o del sistema host. Questo isolamento rende le jails una scelta eccellente per ospitare in modo sicuro piÃ¹ applicazioni su un singolo server, testare software in un ambiente controllato o gestire ambienti multi-tenant.</p><p>Le jails sono altamente configurabili, consentendo di regolare il livello di isolamento e allocazione delle risorse per ciascuna jail. Ãˆ possibile assegnare indirizzi IP specifici, limitare lâ€™uso della CPU e della memoria e controllare lâ€™accesso alle risorse di sistema. Questa flessibilitÃ , combinata con la natura leggera delle jails, le rende una scelta popolare sia per ambienti di sviluppo che di produzione.</p><h2 id=cosÃ¨-bastille>Cosâ€™Ã¨ Bastille?</h2><p><a href=https://bastillebsd.org/ target=_blank rel="noopener noreffer">Bastille</a> Ã¨ unâ€™utilitÃ  da linea di comando per la gestione delle <em>FreeBSD jails</em>. Semplifica il processo di creazione, configurazione e manutenzione delle jails, che sono ambienti leggeri e isolati simili ai container. Bastille fornisce unâ€™interfaccia facile da usare per la gestione delle jails, permettendo agli utenti di distribuire e gestire rapidamente applicazioni in modo sicuro ed efficiente.</p><p>Con Bastille puoi creare nuove jails, avviarle e arrestarle, e gestirne la configurazione con comandi semplici. Supporta anche i <em>template</em>, che possono essere utilizzati per automatizzare la distribuzione di ambienti preconfigurati. Questo lo rende uno strumento eccellente sia per lo sviluppo che per la produzione, dove coerenza e ripetibilitÃ  sono importanti.</p><p>Bastille si integra anche con ZFS, un file system robusto che offre funzionalitÃ  avanzate come snapshot e clonazione. Questa integrazione consente una gestione efficiente dello storage e un facile rollback delle modifiche, migliorando ulteriormente la flessibilitÃ  e lâ€™affidabilitÃ  degli ambienti jail.</p><h3 id=implementare-un-template-bastille-per-nats>Implementare un template Bastille per NATS</h3><p>I <em>template</em> Bastille sono ambienti preconfigurati che possono essere utilizzati per distribuire rapidamente nuove jails. Contengono unâ€™installazione base di FreeBSD insieme a eventuali pacchetti o configurazioni aggiuntive. I template sono una funzionalitÃ  potente di Bastille che puÃ² aiutare a semplificare il flusso di lavoro e garantire coerenza tra gli ambienti.</p><p>Lâ€™idea Ã¨ quella di essere indipendenti dallâ€™architettura, cosÃ¬ il template puÃ² essere utilizzato in qualsiasi sistema FreeBSD. NATS verrÃ  compilato dai sorgenti, quindi il template conterrÃ  i pacchetti necessari per costruirlo.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># installa i pacchetti richiesti</span>
</span></span><span class=line><span class=cl>PKG git
</span></span><span class=line><span class=cl>PKG go
</span></span></code></pre></td></tr></table></div></div><p>Poi possiamo creare un utente e un gruppo specifici per NATS:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># crea il gruppo predefinito</span>
</span></span><span class=line><span class=cl>CMD pw groupadd <span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_GROUP</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># crea lâ€™utente predefinito</span>
</span></span><span class=line><span class=cl>CMD pw useradd -n <span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_USER</span><span class=si>}</span><span class=s2>&#34;</span> -g <span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_GROUP</span><span class=si>}</span><span class=s2>&#34;</span> -s /usr/sbin/nologin -w no
</span></span></code></pre></td></tr></table></div></div><p>Accetteremo i nomi di gruppo e utente come variabili dâ€™ambiente, cosÃ¬ potremo personalizzarli quando creeremo la jail dal template.</p><p>Ora Ã¨ il momento di clonare il repository di NATS e compilarlo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># scarica e installa il server nats</span>
</span></span><span class=line><span class=cl>CMD <span class=s2>&#34;</span><span class=si>${</span><span class=nv>GO</span><span class=si>}</span><span class=s2>&#34;</span> install <span class=s2>&#34;github.com/nats-io/nats-server/v2@</span><span class=si>${</span><span class=nv>NATS_VERSION</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>CMD <span class=s2>&#34;</span><span class=si>${</span><span class=nv>INSTALL</span><span class=si>}</span><span class=s2>&#34;</span> -o <span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_USER</span><span class=si>}</span><span class=s2>&#34;</span> -g <span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_GROUP</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>GOPATH</span><span class=si>}</span><span class=s2>/bin/nats-server&#34;</span> /usr/local/bin/nats-server
</span></span></code></pre></td></tr></table></div></div><p>Utilizzeremo <code>go install</code> per scaricare e compilare il server NATS, quindi lo installeremo nella directory <code>/usr/local/bin</code>. Imposteremo anche proprietario e gruppo del binario allâ€™utente e al gruppo creati in precedenza.</p><p>Una volta installato il server NATS, possiamo creare un file di configurazione e uno script di avvio per esso:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>CP usr /
</span></span><span class=line><span class=cl>CMD chmod a+x /usr/local/etc/rc.d/nats
</span></span></code></pre></td></tr></table></div></div><p>La directory <code>usr</code> contiene il file di configurazione e lo script di avvio per il server NATS. Li copieremo nella directory root della jail e renderemo eseguibile lo script di avvio.</p><p>Infine, imposteremo il server NATS per avviarsi automaticamente allâ€™avvio della jail:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>SYSRC <span class=nv>nats_enable</span><span class=o>=</span>YES
</span></span><span class=line><span class=cl>SYSRC <span class=nv>nats_user</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_USER</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>SYSRC <span class=nv>nats_group</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>NATS_GROUP</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>SERVICE nats start
</span></span></code></pre></td></tr></table></div></div><blockquote><p>Non preoccuparti troppo del template; troverai un link al repository con il codice completo alla fine dellâ€™articolo.</p></blockquote><h2 id=creare-una-jail-nats>Creare una jail NATS</h2><p>Per consentire a Bastille di creare una jail da un template, dobbiamo prima eseguire il bootstrap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille bootstrap https://github.com/henomis/nats-jail-template
</span></span></code></pre></td></tr></table></div></div><p>Questo comando scaricherÃ  il template dal repository; lo troverai nella directory <code>/usr/local/bastille/templates/</code>.</p><p>Ora possiamo creare la jail:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille create nats-jail 14.2-RELEASE 10.0.0.1
</span></span></code></pre></td></tr></table></div></div><p>Questo comando creerÃ  una nuova jail chiamata <code>nats-jail</code>. La jail sarÃ  basata su FreeBSD 14.2-RELEASE e avrÃ  lâ€™indirizzo IP <code>10.0.0.1</code>. Ãˆ ora di applicare il template:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille template nats-jail henomis/nats-jail-template
</span></span></code></pre></td></tr></table></div></div><p>Questo comando applicherÃ  il template alla jail, installando tutti i pacchetti e le configurazioni necessari. Una volta applicato il template, avrai un server NATS pienamente funzionante in esecuzione nella jail.</p><h2 id=testare-la-jail-nats>Testare la jail NATS</h2><p>Per testare la jail NATS, puoi connetterti ad essa usando lo strumento CLI di NATS. Ma, dato che ci siamo giÃ  divertiti con le jails, possiamo crearne una nuova ed eseguire il tool NATS CLI al suo interno. Imposteremo un <em>publisher</em> e un <em>subscriber</em> in due jails diverse, e useremo il server NATS per inviare messaggi tra di loro.</p><p>Creiamo una nuova jail per il publisher:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille create pub-jail 14.2-RELEASE 10.0.0.2
</span></span></code></pre></td></tr></table></div></div><p>Poi installeremo i pacchetti necessari e lo strumento CLI di NATS:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille pkg pub-jail install -y git go
</span></span><span class=line><span class=cl>bastille cmd pub-jail go install github.com/nats-io/natscli/nats@latest
</span></span></code></pre></td></tr></table></div></div><p>Grazie a <code>bastille clone</code> possiamo creare una nuova jail da una esistente, quindi possiamo clonare la jail del publisher e creare una jail per il subscriber:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille clone pub-jail sub-jail 10.0.0.3
</span></span><span class=line><span class=cl>bastille start sub-jail
</span></span></code></pre></td></tr></table></div></div><p>Siamo quasi alla fine, dobbiamo solo avviare il subscriber e il publisher in due jails diverse:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille cmd sub-jail /root/go/bin/nats --server 10.0.0.1 sub my.topic
</span></span></code></pre></td></tr></table></div></div><p>Usando un altro terminale:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>bastille cmd pub-jail /root/go/bin/nats --server 10.0.0.1 pub my.topic <span class=s2>&#34;message {{.Count}} - {{.TimeStamp}}&#34;</span> --count <span class=m>5</span>
</span></span></code></pre></td></tr></table></div></div><p>Dovresti vedere i messaggi inviati dal publisher nel terminale del subscriber.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span><span class=c1>#1] Received on &#34;my.topic&#34;</span>
</span></span><span class=line><span class=cl>message <span class=m>1</span> - 2025-01-01T16:20:16+01:00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=c1>#2] Received on &#34;my.topic&#34;</span>
</span></span><span class=line><span class=cl>message <span class=m>2</span> - 2025-01-01T16:20:16+01:00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=c1>#3] Received on &#34;my.topic&#34;</span>
</span></span><span class=line><span class=cl>message <span class=m>3</span> - 2025-01-01T16:20:16+01:00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=c1>#4] Received on &#34;my.topic&#34;</span>
</span></span><span class=line><span class=cl>message <span class=m>4</span> - 2025-01-01T16:20:16+01:00
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=c1>#5] Received on &#34;my.topic&#34;</span>
</span></span><span class=line><span class=cl>message <span class=m>5</span> - 2025-01-01T16:20:16+01:00
</span></span></code></pre></td></tr></table></div></div><p>Eâ€¦ questo Ã¨ tutto! Hai un server NATS in esecuzione in una jail FreeBSD, e puoi inviare messaggi tra diverse jails usando lo strumento CLI di NATS. Puoi sperimentare con configurazioni diverse, aggiungere altre jails ed esplorare ulteriormente le potenzialitÃ  di NATS e delle FreeBSD jails.</p><h2 id=conclusione>Conclusione</h2><p>In questo articolo abbiamo visto come creare una jail FreeBSD con Bastille ed eseguire al suo interno un server NATS. Abbiamo anche visto come creare due jails aggiuntive e usare lo strumento CLI di NATS per inviare messaggi tra di esse. Questo esempio dimostra la potenza e la flessibilitÃ  delle FreeBSD jails e come possano essere utilizzate per creare ambienti isolati e sicuri per lâ€™esecuzione di applicazioni e servizi.</p><p>Troverai il codice completo nel repository <a href=https://github.com/henomis/nats-jail-template target=_blank rel="noopener noreffer">https://github.com/henomis/nats-jail-template</a>. Sentiti libero di fare un fork e sperimentare sul tuo sistema FreeBSD. Spero che questo articolo ti abbia ispirato a esplorare il mondo delle FreeBSD jails e a sperimentare con diverse applicazioni e servizi. Buon hacking!</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Aggiornato il 2025-01-01</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/running-nats-on-a-freebsd-jail/index.md target=_blank>Leggi Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Condividi su Facebook" data-sharer=facebook data-url=https://simonevellei.com/running-nats-on-a-freebsd-jail/ data-hashtag=nats><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Condividi su Linkedin" data-sharer=linkedin data-url=https://simonevellei.com/running-nats-on-a-freebsd-jail/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Condividi su WhatsApp" data-sharer=whatsapp data-url=https://simonevellei.com/running-nats-on-a-freebsd-jail/ data-title="Running NATS on a FreeBSD Jail" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/nats/>Nats</a>,&nbsp;<a href=/tags/freebsd/>Freebsd</a>,&nbsp;<a href=/tags/jail/>Jail</a>,&nbsp;<a href=/tags/bastille/>Bastille</a>,&nbsp;<a href=/tags/go/>Go</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Indietro</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/3-anni-da-remoto-12-lezioni-imparate/ class=prev rel=prev title="3 anni da remoto, 12 lezioni imparate"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>3 anni da remoto, 12 lezioni imparate</a>
<a href=/referendum-2025/ class=next rel=next title="Referendum 2025, la parola ai dati">Referendum 2025, la parola ai dati<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Realizzato da <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Simone Vellei</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Torna all'inizio"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="Vedi commenti"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.it.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copia negli appunti",maxShownLines:50},comment:{},cookieconsent:{content:{allow:"Allow cookies",close:"&#x274c;",deny:"Decline",dismiss:"Got it!",href:"https://www.cookiesandyou.com",link:"Learn more",message:"This website uses cookies to improve your experience.",policy:"Cookie Policy",target:"_blank"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless",type:"opt-out"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"it",maxResultLength:10,noResultsFound:"Nessun risultato trovato",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>