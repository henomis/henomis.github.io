<!DOCTYPE html>
<html lang="it">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=38913&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>NATS as broker for my home server - Simone Vellei - Blog</title><meta name="Description" content="This is my cool site"><meta property="og:url" content="http://localhost:38913/nats-as-broker-for-my-home-server/">
  <meta property="og:site_name" content="Simone Vellei - Blog">
  <meta property="og:title" content="NATS as broker for my home server">
  <meta property="og:description" content="One of my childhood memories is tied to my auntâ€™s habit of making pizza dough. It was her favorite way to relax. This might seem normal, except that she was a baker by profession. How ironic, isnâ€™t it? The very job that could be a source of stress became her way to unwind. The funny thing is, after becoming a software developer, I found myself in the exact same situation. I love to code, but sometimes I need to do it to relax. And thatâ€™s exactly what happened when I started to develop my home server.">
  <meta property="og:locale" content="it">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-07T17:00:32+02:00">
    <meta property="article:modified_time" content="2025-09-07T17:00:32+02:00">
    <meta property="article:tag" content="Nats">
    <meta property="article:tag" content="Home Server">
    <meta property="article:tag" content="Development">
    <meta property="article:tag" content="Golang">
    <meta property="og:image" content="http://localhost:38913/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:38913/logo.png">
  <meta name="twitter:title" content="NATS as broker for my home server">
  <meta name="twitter:description" content="One of my childhood memories is tied to my auntâ€™s habit of making pizza dough. It was her favorite way to relax. This might seem normal, except that she was a baker by profession. How ironic, isnâ€™t it? The very job that could be a source of stress became her way to unwind. The funny thing is, after becoming a software developer, I found myself in the exact same situation. I love to code, but sometimes I need to do it to relax. And thatâ€™s exactly what happened when I started to develop my home server.">
<meta name="application-name" content="Simone Vellei">
<meta name="apple-mobile-web-app-title" content="Simone Vellei"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://localhost:38913/nats-as-broker-for-my-home-server/" /><link rel="prev" href="http://localhost:38913/referendum-2025/" /><link rel="next" href="http://localhost:38913/siamo-una-grande-famiglia/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "NATS as broker for my home server",
        "inLanguage": "it",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:38913\/nats-as-broker-for-my-home-server\/"
        },"genre": "posts","keywords": "nats, home server, development, golang","wordcount":  1124 ,
        "url": "http:\/\/localhost:38913\/nats-as-broker-for-my-home-server\/","datePublished": "2025-09-07T17:00:32+02:00","dateModified": "2025-09-07T17:00:32+02:00","license": "Â© 2025 Simone Vellei. All rights reserved.","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Simone Vellei"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Simone Vellei - Blog"><span class="header-title-pre">ðŸ‘‹</span>Simone Vellei</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Simone Vellei - Blog"><span class="header-title-pre">ðŸ‘‹</span>Simone Vellei</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">NATS as broker for my home server</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Simone Vellei</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2025-09-07">2025-09-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1124 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/pollenium04.png"
        data-srcset="/images/pollenium04.png, /images/pollenium04.png 1.5x, /images/pollenium04.png 2x"
        data-sizes="auto"
        alt="/images/pollenium04.png"
        title="/images/pollenium04.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#pollenium">Pollenium</a></li>
    <li><a href="#pollen-alerts">Pollen alerts</a></li>
  </ul>

  <ul>
    <li><a href="#listen-for-keystrokes">Listen for keystrokes</a></li>
    <li><a href="#text-to-speech">Text-to-speech</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>One of my childhood memories is tied to my auntâ€™s habit of making pizza dough. It was her favorite way to relax. This might seem normal, except that she was a baker by profession. How ironic, isnâ€™t it? The very job that could be a source of stress became her way to unwind. The funny thing is, after becoming a software developer, I found myself in the exact same situation. I love to code, but sometimes I need to do it to relax. And that&rsquo;s exactly what happened when I started to develop my home server.</p>
<p>This article, however, is not strictly about my home server. Itâ€™s more about the architecture I chose to implement it, specifically using NATS as a message broker. I will explain why I made this choice and how it has benefited my project.</p>
<h1 id="the-home-server">The home server</h1>
<p><strong>TLDR;</strong> A mini-pc equipped with a N100 CPU, 16GB of RAM, and a 512GB SSD, running Debian. All the services are containerized using <code>Docker</code>, and the entire system is managed with a single docker-compose file. That&rsquo;s only the first approach, as I have different plans for the future. Currently, the server runs a few services, including AdGuard, Nextcloud, and Traefik. But the most interesting part is the custom services I developed myself using Go and NATS.</p>
<h1 id="the-first-service-a-pollens-monitoring-system">The first service: a pollens monitoring system</h1>
<p>Did you know that I have allergies? Yes, I do. And I hate them. Every spring, when the pollen count rises, I suffer from sneezing, itchy eyes, and a runny nose. Itâ€™s not fun at all. Luckily, it&rsquo;s not so severe, but itâ€™s still annoying. Last year, I found a way to handle it avoiding drugs relying on natural remedies, mostly based on blackcurrant. But to do that effectively, I needed to know the pollen levels in my area with some day&rsquo;s notice. So, I decided to build a pollen monitoring system using data from the <a href="https://pollini.arpa.marche.it/" target="_blank" rel="noopener noreffer ">ARPAM Marche</a> website, which provides pseudo-real-time pollen data for my region.</p>
<h2 id="pollenium">Pollenium</h2>
<p>The official websiteâ€™s user interface is clunky and slow, but fortunately, it exposes a public API. I leveraged this API by writing a lightweight Go program that fetches daily pollen data for my area. The program handles its own scheduling internally, ensuring the data is updated automatically each day and stored in a local SQLite database. On top of this, I developed a simple web interface that presents the latest readings and visualizes historical trends with interactive graphs, making it easy to track pollen levels over time.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/blog/images/pollenium01.png"
        data-srcset="/blog/images/pollenium01.png, /blog/images/pollenium01.png 1.5x, /blog/images/pollenium01.png 2x"
        data-sizes="auto"
        alt="/blog/images/pollenium01.png"
        title="zoom:Pollen monitoring" /></p>
<p>That&rsquo;s what I called <strong>Pollenium</strong>.</p>
<h2 id="pollen-alerts">Pollen alerts</h2>
<p>Did I mention that I need to be notified when pollen levels are high? Pollenium is great, but if the pollen count spikes, I want to receive an immediate alert. However, I didnâ€™t want to implement this feature directly in Pollenium. I preferred to keep it simple and focused on its core functionality. So, I decided to create a separate architecture to handle notifications. This is where NATS comes into play.</p>
<h1 id="why-nats">Why NATS?</h1>
<p>NATS is a high-performance messaging system that is lightweight and easy to deploy. It supports various messaging patterns, including publish/subscribe, request/reply, and queuing. Here are some reasons why I chose NATS for my home server:</p>
<ul>
<li><strong>Simplicity</strong>: NATS has a simple API and is easy to set up. This was crucial for me as I wanted to focus on developing my home server without getting bogged down in complex configurations.</li>
<li><strong>Performance</strong>: NATS is designed for high throughput and low latency.</li>
<li><strong>Language Support</strong>: NATS has client libraries for many programming languages, including Go, which I used for my home server.</li>
</ul>
<h1 id="notification-service">Notification service</h1>
<p>The easiest way to receive a notification is through a Telegram bot. The new service I implemented listens for messages on specific subjects and sends a message to my Telegram bot chat. The service is highly configurable and you can specify different subjects to listen to, as well as the message format and chat IDs to send the notifications to. I called this service <strong>Telenats</strong>. Notifications are NATS JetStream messages, so they are persistent and can be replayed if needed.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/blog/images/pollenium02.png"
        data-srcset="/blog/images/pollenium02.png, /blog/images/pollenium02.png 1.5x, /blog/images/pollenium02.png 2x"
        data-sizes="auto"
        alt="/blog/images/pollenium02.png"
        title="zoom:Pollen monitoring" /></p>
<h1 id="user-interfaces">User interfaces</h1>
<p>The system was working fine, but I wanted to let NATS handle more than just notifications. Then I had a couple of crazy ideas:</p>
<ul>
<li>why not use NATS to listen for keystrokes?</li>
<li>why not use NATS to dispatch messages for a text-to-speech service?</li>
</ul>
<p>I bought an USB numeric keypad and an USB speaker as input/output devices for my home server.</p>
<h2 id="listen-for-keystrokes">Listen for keystrokes</h2>
<p>I implemented a simple Go program that listens for keystrokes. Every keystroke is captured and published to a related NATS subject. This way, I can send &ldquo;<em>commands</em>&rdquo; to any service listening to that subject. Simple, right? I called this service <strong>Typocast</strong>. I just passed the <code>/dev/input/eventX</code> device as a parameter to the container, and it works like a charm.</p>
<h2 id="text-to-speech">Text-to-speech</h2>
<p>The text-to-speech feature is a little bit more complex. I needed a couple of things:</p>
<ul>
<li>a service that converts text to speech</li>
<li>a service that listens for tts messages and plays the audio after conversion</li>
</ul>
<p>For the text-to-speech conversion, I used <a href="https://github.com/OHF-Voice/piper1-gpl" target="_blank" rel="noopener noreffer ">Piper</a> it has voices in different languages, including Italian. It comes with a simple http server that accepts text and returns an audio file. The second service, which I called <strong>Voicecast</strong>, listens for tts messages on a specific NATS subject. When it receives a message, it sends the text to the Piper server, gets the audio file, and plays it using the classic <code>ALSA</code> interface.</p>
<h1 id="putting-it-all-together">Putting it all together</h1>
<p>Now that I had all the components, I needed to connect them. Hereâ€™s how currently works:</p>
<ol>
<li>Pollenium every day fetches the pollen data and stores it in the database.</li>
<li>If the pollen level exceeds a certain threshold, Pollenium publishes a notification message to a specific NATS subject.</li>
<li>Telenats listens for notification messages and sends a message to my Telegram bot chat.</li>
<li>If I want to hear the current pollen levels, I can press a specific key on my keyboard.</li>
<li>Typocast captures the keystroke and publishes a specific message to the related NATS subject.</li>
<li>Pollenium listens for that subject/keystroke and when it receives the message, it gets from the database the current pollens with high levels and publishes a formatted message to the tts NATS subject.</li>
<li>Voicecast listens for tts messages, sends the text to the Piper server, gets the audio file, and plays it.</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/blog/images/pollenium03.png"
        data-srcset="/blog/images/pollenium03.png, /blog/images/pollenium03.png 1.5x, /blog/images/pollenium03.png 2x"
        data-sizes="auto"
        alt="/blog/images/pollenium03.png"
        title="zoom:Pollen monitoring" /></p>
<h1 id="conclusion">Conclusion</h1>
<p>Using NATS as a message broker for my home server has been a great choice. It has allowed me to build a modular architecture that is easy to maintain and extend. I can easily add new services or modify existing ones without affecting the entire system. Plus, it has been a fun and <strong>relaxing</strong> experience to develop my home server using Go and asynchronous messaging.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2025-09-07</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/nats-as-broker-for-my-home-server/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://localhost:38913/nats-as-broker-for-my-home-server/" data-hashtag="nats"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://localhost:38913/nats-as-broker-for-my-home-server/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://localhost:38913/nats-as-broker-for-my-home-server/" data-title="NATS as broker for my home server" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/nats/">Nats</a>,&nbsp;<a href="/tags/home-server/">Home Server</a>,&nbsp;<a href="/tags/development/">Development</a>,&nbsp;<a href="/tags/golang/">Golang</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/referendum-2025/" class="prev" rel="prev" title="Referendum 2025, la parola ai dati"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Referendum 2025, la parola ai dati</a>
            <a href="/siamo-una-grande-famiglia/" class="next" rel="next" title="Siamo una grande famiglia (e questo Ã¨ un problema)">Siamo una grande famiglia (e questo Ã¨ un problema)<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Simone Vellei</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
